<div class="container py-4">
  <h1>My Favourite Recipes</h1>
  <% @favorites.each do |favorite| %>
    <div data-id="<%= favorite.id %>" class="favorite-recipe">
      <h2><%= favorite.name %></h2>
      <p><%= favorite.description %></p>
      <button class="remove-favorite-button" data-favorite-id="<%= favorite.id %>">Unfavorite</button>
    </div>
  <% end %>
  <%= link_to "Back to curated recipes", recipes_path, method: :get %>
</div>
<%= render "shared/navbar" %>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var removeFavoriteButtons = document.querySelectorAll('.remove-favorite-button');

  removeFavoriteButtons.forEach(function (button) {
    button.addEventListener('click', function () {
      var favoriteId = button.getAttribute('data-favorite-id');
      if (favoriteId) {
        // Make an AJAX request to remove the favorite
        fetch('/favorites/' + favoriteId, {
          method: 'DELETE',
          headers: {
            'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content,
          },
        })
        .then(function (response) {
          if (response.status === 200) {
            // Remove the favorite from the DOM
            var favoriteRecipe = document.querySelector('.favorite-recipe[data-id="' + favoriteId + '"]');
            if (favoriteRecipe) {
              favoriteRecipe.remove();
            }
          }
        })
        .catch(function (error) {
          console.error('Error:', error);
        });
      }
    });
  });
});
</script>
